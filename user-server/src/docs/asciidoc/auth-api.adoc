[[auth-flow]]
== 인증 플로우

=== 소셜 로그인 플로우

[source]
----
1. 클라이언트 -> 소셜 제공자: OAuth 인증 요청
2. 소셜 제공자 -> 클라이언트: Access Token 발급
3. 클라이언트 -> 서버: POST /api/v1/auth/login/{provider} (Access Token 전송)
4-1. 신규 사용자: isSignup=true, social 정보 반환
4-2. 기존 사용자: isSignup=false, JWT 토큰 반환
5. (신규 사용자) 클라이언트 -> 서버: POST /api/v1/auth/signup/complete
6. 서버 -> 클라이언트: JWT 토큰 발급
----

=== 이메일 로그인 플로우

[source]
----
1. 클라이언트 -> 서버: POST /api/v1/auth/login/email (이메일, 비밀번호)
2. 서버: 인증 확인
3. 서버 -> 클라이언트: JWT 토큰 발급
----

=== 토큰 갱신 플로우

[source]
----
1. 클라이언트: Access Token 만료 감지
2. 클라이언트 -> 서버: POST /api/v1/auth/refresh (Refresh Token)
3. 서버: Refresh Token 검증
4. 서버 -> 클라이언트: 새로운 Access Token 발급
----

[[auth-api]]
== 인증 API

[[auth-social-login]]
=== 소셜 로그인

소셜 제공자(카카오, 네이버, 구글)를 통한 로그인입니다.

==== HTTP 요청
include::{snippets}/auth/social-login/http-request.adoc[]

==== 경로 파라미터
include::{snippets}/auth/social-login/path-parameters.adoc[]

==== 요청 필드
include::{snippets}/auth/social-login/request-fields.adoc[]

==== HTTP 응답
include::{snippets}/auth/social-login/http-response.adoc[]

==== 응답 필드
include::{snippets}/auth/social-login/response-fields.adoc[]

==== 지원하는 소셜 제공자
* `KAKAO` - 카카오
* `NAVER` - 네이버
* `GOOGLE` - 구글

==== 응답 구조
* `isSignup=true`: 신규 사용자, 회원가입 추가 정보 입력 필요
* `isSignup=false`: 기존 사용자, 로그인 완료 (JWT 토큰 발급)

[[auth-email-login]]
=== 이메일 로그인

이메일과 비밀번호로 로그인합니다.

==== HTTP 요청
include::{snippets}/auth/email-login/http-request.adoc[]

==== 요청 필드
include::{snippets}/auth/email-login/request-fields.adoc[]

==== HTTP 응답
include::{snippets}/auth/email-login/http-response.adoc[]

==== 응답 필드
include::{snippets}/auth/email-login/response-fields.adoc[]

==== 제약사항
* 이메일은 반드시 가입된 이메일이어야 합니다.
* 비밀번호가 일치하지 않으면 401 에러가 반환됩니다.
* 탈퇴하거나 정지된 회원은 로그인할 수 없습니다.

[[auth-check-nickname]]
=== 닉네임 중복 확인

회원가입 시 닉네임이 이미 사용중인지 확인합니다.

==== HTTP 요청
include::{snippets}/auth/check-nickname/http-request.adoc[]

==== HTTP 응답
include::{snippets}/auth/check-nickname/http-response.adoc[]

==== 응답 필드
include::{snippets}/auth/check-nickname/response-fields.adoc[]

==== 제약사항
* 닉네임은 2자 이상 10자 이하여야 합니다.
* 특수문자는 사용할 수 없습니다.

[[auth-check-email]]
=== 이메일 중복 확인

회원가입 시 이메일이 이미 사용중인지 확인합니다.

==== HTTP 요청
include::{snippets}/auth/check-email/http-request.adoc[]

==== HTTP 응답
include::{snippets}/auth/check-email/http-response.adoc[]

==== 응답 필드
include::{snippets}/auth/check-email/response-fields.adoc[]

==== 제약사항
* 유효한 이메일 형식이어야 합니다.
* 소셜 로그인으로 가입한 이메일도 중복으로 처리됩니다.

[[auth-refresh-token]]
=== 액세스 토큰 갱신

Refresh Token을 사용하여 새로운 Access Token을 발급받습니다.

==== HTTP 요청
include::{snippets}/auth/refresh-token/http-request.adoc[]

==== 요청 필드
include::{snippets}/auth/refresh-token/request-fields.adoc[]

==== HTTP 응답
include::{snippets}/auth/refresh-token/http-response.adoc[]

==== 응답 필드
include::{snippets}/auth/refresh-token/response-fields.adoc[]

==== 제약사항
* Refresh Token이 만료된 경우 401 에러가 반환됩니다.
* 유효하지 않은 Refresh Token인 경우 401 에러가 반환됩니다.
* Refresh Token은 로그아웃 시 무효화됩니다.

[[jwt-token]]
== JWT 토큰

=== 토큰 구조

|===
| 토큰 종류 | 유효 기간 | 용도

| Access Token
| 1시간
| API 요청 시 인증에 사용

| Refresh Token
| 7일
| Access Token 갱신에 사용
|===

=== 토큰 사용 방법

HTTP 요청 헤더에 다음과 같이 포함:

[source,http]
----
Authorization: Bearer {access_token}
----

=== 토큰 만료 처리

1. API 요청 시 401 Unauthorized 응답
2. Refresh Token으로 새 Access Token 발급
3. 재요청
4. Refresh Token도 만료된 경우 재로그인 필요

[[auth-error-codes]]
== 에러 코드

|===
| 에러 코드 | HTTP 상태 | 설명

| `USER001`
| 404 Not Found
| 사용자를 찾을 수 없습니다

| `USER002`
| 403 Forbidden
| 탈퇴한 사용자입니다

| `USER003`
| 403 Forbidden
| 정지된 사용자입니다

| `USER004`
| 401 Unauthorized
| 비밀번호가 일치하지 않습니다

| `TOKEN001`
| 401 Unauthorized
| 유효하지 않은 토큰입니다

| `TOKEN002`
| 401 Unauthorized
| 만료된 토큰입니다
|===
